const mixEnergyType={consumption:{colorScale:d3.scaleThreshold().domain(["oil","other"]).range(["#","#1f77b4","#aec7e8"]),legend:"Consommation (TWh)",title:e=>`Share of annual oil consumption in the global energy mix in ${e}`}},mixTitle=document.querySelector("#mix-title"),mixLegend=document.querySelector("#mix-legend"),mixWidth=width/2,mixHeight=height/2,mixMargin=width/30;var donutRadius=mixHeight/2-mixMargin;const mixSvg=d3.select("#mix-chart-container").append("svg").attr("flex",1).attr("width",mixWidth).attr("height",mixHeight).attr("overflow","visible").append("g").attr("transform","translate("+mixWidth/2+","+mixHeight/2+")");var donutPie=d3.pie().value((function(e){return e.value}));const centerText=mixSvg.append("text").attr("text-anchor","middle").attr("font-size","2em").attr("font-weight","bold").attr("dy","0.25em");function updateCenterText(e){e.includes("NaN")&&(e="No data"),centerText.text(e)}function drawDonut(e){var t=donutPie(d3.entries(e));mixSvg.selectAll("path").remove(),mixSvg.selectAll("whatever").data(t).enter().append("path").merge(mixSvg.selectAll("path")).transition().duration(500).attr("d",d3.arc().innerRadius(width/10).outerRadius(donutRadius)).attr("overflow","visible").attr("fill",(function(e){return mixEnergyType.consumption.colorScale(e.data.key)}))}function retrieveMixData(e,t){let i=0;if(0==selectedCountries.length)i=100*e.get(t).OWID_WRL.mix;else{i=0;let n=selectedCountries.length,a=0;for(let r=0;r<n;r++)e.get(t)[selectedCountries[r]]&&e.get(t)[selectedCountries[r]].mix&&(i+=100*e.get(t)[selectedCountries[r]].mix,a++);i/=a}return{oil:i,other:100-i}}function updateMix(e){mixTitle.innerText=mixEnergyType.consumption.title(yearSlider.value);let t=retrieveMixData(e,yearSlider.value);drawDonut(t),updateCenterText(t.oil.toFixed(0)+"%")}function mixReady(e){updateMix(e),yearSlider.addEventListener("input",(()=>{updateMix(e)})),mapSvg.addEventListener("click",(()=>{updateMix(e)})),countryListBox.addEventListener("change",(()=>{updateMix(e)})),document.getElementById("map-deselect-btn").addEventListener("click",(()=>{updateMix(e)}))}